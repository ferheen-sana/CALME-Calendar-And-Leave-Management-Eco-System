{% extends "layout_manager.html" %}
{% block content %}

<style>
/* ---------- PAGE ---------- */
.dashboard-title{
    font-weight:700;
    color:#7c2d12; /* manager theme */
    margin-bottom:15px;
}

/* ---------- TOOLBAR ---------- */
.calendar-toolbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
    background:#ffffff;
    padding:12px 16px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,.12);
}

/* ---------- GRID ---------- */
.calendar-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:18px;
}

/* ---------- MONTH BOX ---------- */
.month-box{
    background:#ffffff;
    border-radius:14px;
    padding:10px;
    box-shadow:0 8px 20px rgba(0,0,0,.15);
    animation:fadeUp .5s ease;
}

@keyframes fadeUp{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}

.month-title{
    text-align:center;
    font-weight:700;
    color:#7c2d12;
    margin-bottom:6px;
    font-size:14px;
}

/* ---------- DAYS ---------- */
.weekdays,.days{
    display:grid;
    grid-template-columns:repeat(7,1fr);
    text-align:center;
}

.weekdays div{
    font-size:11px;
    font-weight:600;
    color:#475569;
}

.day{
    font-size:11px;
    padding:6px;
    margin:2px;
    border-radius:6px;
    cursor:pointer;
    position:relative;
    transition:.25s;
}

.day:hover{
    transform:scale(1.15);
    z-index:2;
}

/* ---------- COLORS ---------- */
.ada{background:#16a34a;color:#fff;}
.rh{background:#facc15;}
.conflict{background:#dc2626;color:#fff;}

/* ---------- TOOLTIP ---------- */
.day:hover::after{
    content:attr(data-tip);
    position:absolute;
    bottom:130%;
    left:50%;
    transform:translateX(-50%);
    background:#0f172a;
    color:#fff;
    font-size:10px;
    padding:5px 8px;
    border-radius:6px;
    white-space:nowrap;
    box-shadow:0 4px 12px rgba(0,0,0,.3);
}
</style>

<h4 class="dashboard-title">ðŸ“… Manager Leave Dashboard (All Employees)</h4>

<div class="calendar-toolbar">
    <select id="yearSelect" class="form-select" style="width:140px"></select>

    <div>
        <span class="badge bg-success">ADA Holiday</span>
        <span class="badge bg-warning text-dark">RH</span>
        <span class="badge bg-danger">Conflict</span>
    </div>
</div>

<div id="calendar" class="calendar-grid"></div>


<script>
const employeeLeaves = {{ calendar_data|safe }};
</script>

<script>
const months=[
 "January","February","March","April","May","June",
 "July","August","September","October","November","December"
];

const adaHolidays={
 "2026-01-01":"New Year",
 "2026-08-15":"Independence Day"
};

const rhHolidays={
 "2026-01-26":"Republic Day"
};

const yearSelect=document.getElementById("yearSelect");
const calendar=document.getElementById("calendar");

for(let y=2024;y<=2030;y++){
    yearSelect.innerHTML+=`<option ${y===2026?"selected":""}>${y}</option>`;
}

yearSelect.onchange=()=>renderCalendar(yearSelect.value);

function renderCalendar(year){
    calendar.innerHTML="";
    months.forEach((m,monthIndex)=>{
        const box=document.createElement("div");
        box.className="month-box";

        box.innerHTML=`
            <div class="month-title">${m}</div>
            <div class="weekdays">
                <div>Mo</div><div>Tu</div><div>We</div>
                <div>Th</div><div>Fr</div><div>Sa</div><div>Su</div>
            </div>
            <div class="days"></div>
        `;

        const daysDiv=box.querySelector(".days");
        const firstDay=new Date(year,monthIndex,1).getDay()||7;
        const totalDays=new Date(year,monthIndex+1,0).getDate();

        for(let i=1;i<firstDay;i++) daysDiv.innerHTML+=`<div></div>`;

        for(let d=1;d<=totalDays;d++){
            const key=`${year}-${String(monthIndex+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
            let cls="",tip="",style="";

            if(adaHolidays[key]){
                cls="ada"; tip=adaHolidays[key];
            }
            else if(rhHolidays[key]){
                cls="rh"; tip=rhHolidays[key];
            }
            else if(employeeLeaves[key]){
                if(employeeLeaves[key].length>1){
                    cls="conflict";
                    tip = employeeLeaves[key].map(e=>e.name).join(", ")+" on leave";
                }else{
                    style = `background:${employeeLeaves[key][0].color};color:#fff;`;
                    tip = employeeLeaves[key][0].name+" on leave";
                }
            }

            daysDiv.innerHTML+=`
                <div class="day ${cls}" style="${style}" data-tip="${tip}">
                    ${d}
                </div>`;
        }

        calendar.appendChild(box);
    });
}

renderCalendar(2026);
</script>

{% endblock %}

<!-- ================= ADVANCED ZENDAY CALENDAR ================= -->
<div id="zendayCalendar" style="display:none;">
    <div class="zenday-wrapper">
        <div id="zendayTimeline"></div>
    </div>
</div>
