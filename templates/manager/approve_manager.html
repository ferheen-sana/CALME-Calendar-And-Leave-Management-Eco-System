{% extends "layout_manager.html" %}
{% load static %}

{% block content %}

<style>
/* ===== Page Background ===== */
.page-wrap{
    background:linear-gradient(135deg,#eef2ff,#f8fafc);
    padding:26px;
    border-radius:20px;
}

/* ===== Header ===== */
.header-box{
    background:linear-gradient(135deg,#2563eb,#1e40af);
    color:white;
    padding:24px;
    border-radius:18px;
    margin-bottom:26px;
    box-shadow:0 14px 36px rgba(37,99,235,.35);
}
.header-box h4{
    font-weight:700;
    margin-bottom:6px;
}
.header-box p{
    opacity:.9;
    margin:0;
    font-size:14px;
}

/* ===== Card ===== */
.card-box{
    background:rgba(255,255,255,.92);
    backdrop-filter:blur(10px);
    border-radius:20px;
    padding:22px;
    box-shadow:0 12px 34px rgba(0,0,0,.08);
}

/* ===== TABLE HEADER HEIGHT & STYLE ===== */
.table thead th{
    padding:18px 14px;          /* ⬅ HEIGHT INCREASED */
    font-size:13px;
    text-transform:uppercase;
    letter-spacing:.08em;
    color:#334155;
    background:#f1f5f9;
    vertical-align:middle;
}

/* ===== Table Body ===== */
.table{
    border-collapse:separate;
    border-spacing:0 12px;
}
.table tbody tr{
    background:white;
    border-radius:16px;
    transition:.25s ease;
}
.table tbody tr:hover{
    transform:scale(1.01);
    box-shadow:0 10px 24px rgba(0,0,0,.08);
}
.table td{
    border:0;
    padding:14px;
    vertical-align:middle;
}

/* ===== Employee ===== */
.emp-box{
    display:flex;
    align-items:center;
    gap:14px;
}
.emp-avatar{
    width:42px;
    height:42px;
    border-radius:50%;
    background:linear-gradient(135deg,#6366f1,#4338ca);
    color:white;
    font-weight:700;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:16px;
}
.emp-name{
    font-weight:600;
    color:#0f172a;
    font-size:15px;
}
.emp-designation{
    font-size:13px;
    color:#64748b;
}

/* ===== Badges ===== */
.badge{
    padding:6px 14px;
    border-radius:22px;
    font-size:12px;
    font-weight:600;
}
.badge-cl{ background:#eff6ff; color:#1d4ed8; }
.badge-rh{ background:#fefce8; color:#a16207; }

.status-pending{ background:#fffbeb; color:#b45309; }
.status-approved{ background:#ecfdf5; color:#166534; }
.status-rejected{ background:#fef2f2; color:#991b1b; }

/* ===== Buttons ===== */
.btn-approve{
    background:linear-gradient(135deg,#22c55e,#15803d);
    color:white;
    border-radius:22px;
    padding:6px 16px;
}
.btn-reject{
    background:linear-gradient(135deg,#ef4444,#b91c1c);
    color:white;
    border-radius:22px;
    padding:6px 16px;
}
.btn-approve:hover{ opacity:.9; }
.btn-reject:hover{ opacity:.9; }
</style>

<div class="page-wrap">

    <!-- ===== Header ===== -->
    <div class="header-box">
        <h4>Leave Approval Dashboard</h4>
        <p>Review, approve or reject employee leave requests</p>
    </div>

    <!-- ===== Card ===== -->
    <div class="card-box">

        <table class="table align-middle">
            <thead>
                <tr>
                    <th>Employee</th>
                    <th>Designation</th>
                    <th>Leave</th>
                    <th>From</th>
                    <th>To</th>
                    <th>Reason</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
            {% for leave in leaves %}
            <tr>

                <!-- Employee -->
                <td>
                    <div class="emp-box">
                        <div class="emp-avatar">
                            {{ leave.user.username|first|upper }}
                        </div>
                        <div>
                            <div class="emp-name">
                                {{ leave.user.get_full_name|default:leave.user.username }}
                            </div>
                        </div>
                    </div>
                </td>

                <!-- Designation -->
                <td>
                    <span class="emp-designation">
                        {% if leave.user.profile.designation == "ENGINEER" %}
                            Engineer
                        {% elif leave.user.profile.designation == "PA" %}
                            Personal Assistant
                        {% elif leave.user.profile.designation == "CONSULTANT" %}
                            Consultant
                        {% else %}
                            —
                        {% endif %}
                    </span>
                </td>

                <!-- Leave -->
                <td>
                    {% if leave.leave_type == "CL" %}
                        <span class="badge badge-cl">Casual Leave</span>
                    {% else %}
                        <span class="badge badge-rh">Restricted Holiday</span>
                    {% endif %}
                </td>

                <td>{{ leave.start_date }}</td>
                <td>{{ leave.end_date }}</td>

                <!-- Reason -->
                <td>{{ leave.reason|truncatewords:6 }}</td>

                <!-- Status -->
                <td>
                    {% if leave.status == "PENDING" %}
                        <span class="badge status-pending">Pending</span>
                    {% elif leave.status == "APPROVED" %}
                        <span class="badge status-approved">Approved</span>
                    {% else %}
                        <span class="badge status-rejected">Rejected</span>
                    {% endif %}
                </td>

                <!-- Action -->
                <td>
                    {% if leave.status == "PENDING" %}
                        <button class="btn btn-sm btn-approve"
                                onclick="openConfirm('{{ leave.id }}','approve')">
                            Approve
                        </button>
                        <button class="btn btn-sm btn-reject"
                                onclick="openConfirm('{{ leave.id }}','reject')">
                            Reject
                        </button>
                    {% else %}
                        —
                    {% endif %}
                </td>

            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="text-center text-muted">
                    No leave requests found
                </td>
            </tr>
            {% endfor %}
            </tbody>

        </table>

    </div>
</div>
<script>
function openConfirm(leaveId, action) {
    let url = "";

    if (action === "approve") {
        url = "/manager/leave/approve/" + leaveId + "/";
    } else {
        url = "/manager/leave/reject/" + leaveId + "/";
    }

    if (confirm("Are you sure?")) {
        window.location.href = url;
    }
}
</script>

{% endblock %}
